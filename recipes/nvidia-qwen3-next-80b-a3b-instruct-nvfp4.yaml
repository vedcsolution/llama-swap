recipe_version: "1"
name: nvidia/Qwen3-Next-80B-A3B-Instruct-NVFP4
description: vLLM serving nvidia/Qwen3-Next-80B-A3B-Instruct-NVFP4 on a SINGLE NODE ONLY!
runtime: vllm
backend: spark-vllm-docker

# HuggingFace model to download (optional, for --download-model)
model: nvidia/Qwen3-Next-80B-A3B-Instruct-NVFP4

# Container image to use
container: vllm-node:latest

# This model can only run on single node (solo)
solo_only: true

# Default settings (can be overridden via CLI)
defaults:
  port: 8000
  host: 0.0.0.0
  tensor_parallel: 1
  gpu_memory_utilization: 0.7
  max_model_len: 128000

# Environment variables
env:
  VLLM_USE_FLASHINFER_MOE_FP4: 1
  VLLM_FLASHINFER_MOE_BACKEND: "throughput"
  VLLM_NVFP4_GEMM_BACKEND: marlin
  VLLM_TEST_FORCE_FP8_MARLIN: 1
  VLLM_MARLIN_USE_ATOMIC_ADD: 1

# The vLLM serve command template
command: |
  vllm serve nvidia/Qwen3-Next-80B-A3B-Instruct-NVFP4  \
     --max-model-len {max_model_len} \
     --port {port} --host {host} \
     --trust-remote-code \
     --enable-auto-tool-choice  \
     --tool-call-parser qwen3_coder \
     --load-format fastsafetensors  \
     --gpu-memory-utilization {gpu_memory_utilization}
